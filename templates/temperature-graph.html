{% extends 'base.html' %}
{% block title %}Temperature Comparison{% endblock %}
{% block head %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>
{% endblock %}
{% block content %}
    <div x-data="{ hours: 24, selectedModule: '', availableModules: [], dataType: 'preprocessed', loading: false, error: null, lastUpdated: 'Never', async loadModules() { try { const response = await fetch('/api/modules'); if (response.ok) { const data = await response.json(); this.availableModules = data.modules || []; } } catch (error) { console.error('Error loading modules:', error); } }, refreshImage() { const img = document.getElementById('temperature-comparison-plot'); if (img) { let src = `/api/analysis/temperature-comparison?hours=${this.hours}`; if (this.selectedModule) src += `&module_id=${encodeURIComponent(this.selectedModule)}`; src += `&data_type=${this.dataType}`; src += `&t=${Date.now()}`; img.src = src; this.lastUpdated = new Date().toLocaleString(); } } , init() { this.loadModules(); this.refreshImage(); } }" x-init="init()">
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-500 to-blue-700 text-white p-8 text-center">
            <h1 class="text-4xl font-bold mb-3">üå°Ô∏è Temperature Comparison</h1>
            <p class="text-lg opacity-90">Predicted vs Actual Temperature Values</p>
        </div>
        <!-- Controls -->
        <div class="p-6 bg-gray-50 border-b border-gray-200">
            <div class="flex flex-wrap items-center gap-4">
                <div class="flex items-center gap-2">
                    <label for="hours" class="text-gray-700 font-medium">Time Range:</label>
                    <select 
                        id="hours" 
                        x-model="hours" 
                        @change="refreshImage()"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="6">Last 6 hours</option>
                        <option value="12">Last 12 hours</option>
                        <option value="24" selected>Last 24 hours</option>
                        <option value="48">Last 48 hours</option>
                        <option value="168">Last week</option>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label for="module" class="text-gray-700 font-medium">Module:</label>
                    <select 
                        id="module" 
                        x-model="selectedModule" 
                        @change="refreshImage()"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="">All Modules</option>
                        <template x-for="module in availableModules" :key="module">
                            <option :value="module" x-text="module"></option>
                        </template>
                    </select>
                </div>
                <div class="flex items-center gap-2">
                    <label for="dataType" class="text-gray-700 font-medium">Data Type:</label>
                    <select 
                        id="dataType" 
                        x-model="dataType" 
                        @change="refreshImage()"
                        class="border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="preprocessed">Preprocessed Data</option>
                        <option value="source">Source Data</option>
                    </select>
                </div>
                <button 
                    @click="refreshImage()" 
                    class="bg-blue-500 hover:bg-blue-600 text-white border-none py-2 px-4 rounded-lg cursor-pointer transition-colors duration-300"
                >
                    üîÑ Refresh
                </button>
            </div>
        </div>
        <!-- Chart Container -->
        <div class="p-6">
            <div class="bg-white rounded-xl border border-gray-200 p-6 flex flex-col items-center justify-center" style="min-height: 500px;">
                <img id="temperature-comparison-plot" :src="`/api/analysis/temperature-comparison?hours=${hours}${selectedModule ? `&module_id=${encodeURIComponent(selectedModule)}` : ''}&data_type=${dataType}`" alt="Temperature Comparison" class="w-full max-w-4xl rounded-lg shadow-sm border" style="min-height: 400px; background: #f8fafc;" @load="loading=false" @error="error='Failed to load image'">
            </div>
            <div class="mt-4 text-sm text-gray-500 text-center">Last updated: <span x-text="lastUpdated"></span></div>
            <div x-show="error" class="text-red-600 text-center mt-2" x-text="error"></div>
        </div>
    </div>
{% endblock %} 